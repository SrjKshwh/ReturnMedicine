{% extends "base.html" %}

{% block title %}Manage Users{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <h2>Manage Users</h2>
            <div class="alert alert-info">
                <h5>How to use this page:</h5>
                <p>This page allows administrators to manage all user accounts in the system. View the list of current users with their details including username, email, company, and role. Use the "Edit" button to modify user information and roles. The "Delete" button removes users from the system (you cannot delete your own account). Roles determine access permissions: User (basic access), Reviewer (can approve submissions), Admin (full system access). Changes take effect immediately.</p>
            </div>
            <p class="text-muted">Manage user accounts and roles.</p>

            <div class="card">
                <div class="card-header">
                    <h5>Current Users</h5>
                </div>
                <div class="card-body">
                    {% if users %}
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Company</th>
                                        <th>Role</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for user in users %}
                                    <tr>
                                        <td>{{ user.id }}</td>
                                        <td>{{ user.username }}</td>
                                        <td>{{ user.email }}</td>
                                        <td>{{ user.company_name or 'N/A' }}</td>
                                        <td>
                                            <span class="badge bg-{{ 'primary' if user.role == 'admin' else 'secondary' if user.role == 'reviewer' else 'info' }}">
                                                {{ user.role.title() }}
                                            </span>
                                        </td>
                                        <td>
                                            <a href="{{ url_for('edit_user', id=user.id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
                                            {% if user.id != current_user.id %}
                                            <form method="POST" action="{{ url_for('delete_user', id=user.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this user?')">
                                                <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                                            </form>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted">No users found.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
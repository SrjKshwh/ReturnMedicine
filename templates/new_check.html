{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-lg-8 col-md-10 col-sm-12">
        <div class="card p-4">
            <h1 class="card-title text-center text-primary mb-4">New Check Entry</h1>
            <div class="alert alert-info">
                <h5>How to use this page:</h5>
                <p>This page allows you to create a new check statement entry with payment details. Enter the statement number, payment date, check number, and total amount. Add check details by specifying return numbers, amounts, and optionally uploading PDF files for each detail. You can add multiple details using the "Add Detail" button. The check statement will be saved and can be viewed in the checks list for payment tracking.</p>
            </div>
            <form method="POST" enctype="multipart/form-data">
                {{ form.hidden_tag() }}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        {{ form.statement_no.label(class="form-label") }}
                        {{ form.statement_no(class="form-control") }}
                        {% if form.statement_no.errors %}
                            <div class="text-danger">
                                {% for error in form.statement_no.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        {{ form.payment_date.label(class="form-label") }}
                        {{ form.payment_date(class="form-control") }}
                        {% if form.payment_date.errors %}
                            <div class="text-danger">
                                {% for error in form.payment_date.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        {{ form.check_no.label(class="form-label") }}
                        {{ form.check_no(class="form-control") }}
                        {% if form.check_no.errors %}
                            <div class="text-danger">
                                {% for error in form.check_no.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        {{ form.amount.label(class="form-label") }}
                        {{ form.amount(class="form-control") }}
                        {% if form.amount.errors %}
                            <div class="text-danger">
                                {% for error in form.amount.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Check Details Section -->
                <div class="mb-4">
                    <h4 class="text-primary mb-3">Add Detail</h4>
                    <div id="details-container">
                        <!-- Dynamic detail rows will be added here -->
                    </div>
                    <button type="button" class="btn btn-secondary" id="add-detail">Add Detail</button>
                </div>

                {{ form.submit(class="btn btn-primary w-100 mt-3") }}
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let detailIndex = 0;

    function addDetailRow() {
        const container = document.getElementById('details-container');
        const row = document.createElement('div');
        row.className = 'detail-row border p-3 mb-3 rounded';
        row.innerHTML = `
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Return #</label>
                    <input type="text" class="form-control" name="details-${detailIndex}-return_no" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Amount</label>
                    <input type="number" step="0.01" class="form-control" name="details-${detailIndex}-amount" required>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">PDF Upload</label>
                    <input type="file" class="form-control" name="details-${detailIndex}-pdf_file" accept=".pdf">
                </div>
                <div class="col-md-1 mb-3 d-flex align-items-end">
                    <button type="button" class="btn btn-danger remove-detail">Remove</button>
                </div>
            </div>
        `;
        container.appendChild(row);
        detailIndex++;
    }

    document.getElementById('add-detail').addEventListener('click', addDetailRow);

    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-detail')) {
            e.target.closest('.detail-row').remove();
        }
    });

    // Add one initial row
    addDetailRow();
});
</script>
{% endblock %}